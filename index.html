<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ã‚¿ã‚¹ã‚¯ç®¡ç†å¯¾æˆ¦ã‚µã‚¤ãƒˆ</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: sans-serif; margin: 10px; }
button { padding: 10px; margin: 5px; }
.task { display:flex; align-items:center; margin:5px 0; }
.hidden { display:none; }
</style>
</head>

<body>

<div id="select">
  <h2>ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé¸æŠ</h2>
  <button onclick="login('ryu')">ã‚Šã‚…ã†</button>
  <button onclick="login('sashi')">ã‚µã‚·</button>
</div>

<div id="home" class="hidden">
  <button onclick="toggleScore()">ğŸ“Š ã‚¹ã‚³ã‚¢ã‚’è¦‹ã‚‹</button>

  <div id="score" class="hidden">
    <p>ã‚Šã‚…ã† åˆè¨ˆ: <span id="ryuTotal">0</span> ç‚¹</p>
    <p>ã‚µã‚· åˆè¨ˆ: <span id="sashiTotal">0</span> ç‚¹</p>
    <canvas id="chart"></canvas>
  </div>

  <h3 id="today"></h3>
  <div id="tasks"></div>
  <button onclick="save()">ä¿å­˜</button>
</div>

<script>
const tasks = [
 "8æ™‚é–“å¯ã‚‹","é‹å‹•","èµ·ãã¦ã‹ã‚‰æ°´ã‚’é£²ã‚€",
 "çŸ¥ã‚ŠãŸã„ã“ã¨ã‚’å‹‰å¼·ã™ã‚‹","ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰ã‚’é£Ÿã¹ãªã„",
 "å¥åº·çš„ãªé£Ÿäº‹ã‚’1å›ã™ã‚‹","ã‚¹ã‚­ãƒ³ã‚±ã‚¢"
];

let user="", chart;

function login(u){
 user=u;
 document.getElementById("select").classList.add("hidden");
 document.getElementById("home").classList.remove("hidden");
 document.getElementById("today").innerText = "ä»Šæ—¥: " + new Date().toLocaleDateString();
 const box=document.getElementById("tasks");
 box.innerHTML="";
 tasks.forEach((t,i)=>{
  box.innerHTML+=`<div class="task"><input type="checkbox" id="t${i}"> ${t}</div>`;
 });
 update();
}

function calc(n){
 if(n===0) return 0;
 if(n<=2) return 1;
 if(n===4) return 3;
 if(n===5) return 4;
 return 5;
}

function save(){
 const count=[...document.querySelectorAll("input")].filter(c=>c.checked).length;
 const add=calc(count);
 const data=JSON.parse(localStorage.getItem(user)||"[]");
 data.push(add);
 localStorage.setItem(user,JSON.stringify(data));
 update();
 alert("ä¿å­˜ã—ã¾ã—ãŸ");
}

function update(){
 const r=JSON.parse(localStorage.getItem("ryu")||"[]").reduce((a,b)=>a+b,0);
 const s=JSON.parse(localStorage.getItem("sashi")||"[]").reduce((a,b)=>a+b,0);
 ryuTotal.innerText=r;
 sashiTotal.innerText=s;
 draw();
}

function toggleScore(){
 document.getElementById("score").classList.toggle("hidden");
}

function draw(){
 const ctx=document.getElementById("chart");
 if(chart) chart.destroy();
 chart=new Chart(ctx,{
  type:"line",
  data:{
   labels:[...Array(32).keys()],
   datasets:[
    {label:"ã‚Šã‚…ã†",data:JSON.parse(localStorage.getItem("ryu")||"[]")},
    {label:"ã‚µã‚·",data:JSON.parse(localStorage.getItem("sashi")||"[]")}
   ]
  }
 });
}
</script>

</body>
</html>
